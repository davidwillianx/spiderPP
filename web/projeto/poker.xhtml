<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    template="/WEB-INF/templates/dashboard_projeto_game.xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="content-dashboard" >
        <h:outputScript library="styles" name="assets/js/gamescript.js"/>   
        
         <script type="text/javascript">
             
            $(document).ready(socketStart);
        
            function socketStart(){
                
               var room = #{projeto.id};
               var  host = "ws://localhost:8080/spiderPP/spiderSocketGame/";
               var spiderSocket = new WebSocket(host+room);
               
               $("#chat-message-input").keypress(function(messageContent){
                     if(messageContent.keyCode === 13){
                         messageContent.preventDefault();
                          
                          chatMessage = {
                               "id"     :  #{usuario.id},
                               "author" : "#{usuario.nome}",
                               "message":  $(this).val()
                              };
                          
                          sendMessage(spiderSocket,chatMessage);
                       }
               });
               
               spiderSocket.onmessage = function(event)
               {
                   chatMessage = JSON.parse(event.data);
                   appendMessageReceived(chatMessage.message);
                   scrollToFinish();
               };
            }
         
         </script>
        
    </ui:define>


</ui:composition>
 
